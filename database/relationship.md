# 関係モデル

## 関係モデル
データベースが関係モデルを採用している場合、システムの内部は、論理層や外部層のような高い階層とは完全に独立することになる。  
**理由**: 関係モデルはデータインスタンスをモデルで定義された関数の入力/出力とする特性を持つから。この特性によって、データベースシステムがブラックボックスを作ることができ、DBMSユーザーは高い階層で作業を行うことができる。データモデルに従っているのでACID特性も保証されている。

![relational-database (1)](https://github.com/user-attachments/assets/c10a56e2-252f-4468-999b-f70658810140)

## 関係
- **関係代数**: 関係と呼ばれるデータの集合を定義し、関係を入出力とする関数を定義する数学理論のこと

![relational-algebra](https://github.com/user-attachments/assets/1d412977-63a8-449a-9730-b01b1ad464c8)

リレーショナルデータベースは、関係モデルを用いてデータを論理的に整理しており、DMLのクエリコマンドは関係代数で定義された関数から派生  

- **テーブル(関係)**
同じサイズのタプルの集合であり、タプル内の各一は属性によって定義される。

- **タプル(行)**
固定サイズのデータのリスト。`n-タプル`と呼ばれ、nはリストの長さを表す。(固定サイズが3 -> 3タプル)

- **属性(列)**
タプル内の位置を特定するもので、データ型や定義域などのプロパティを定義する。
**定義域**とは許容される値の集合を指す。(unsigned ints -> 全ての正の整数になる)

![tuple](https://github.com/user-attachments/assets/868f506c-170b-45b3-bc33-513fcfa2c668)

### 関係代数とリレーショナルデータベースの違い
- **nタプルの行を格納する関係**: `n`個の属性を含み、関係は可能な限り多くのタプルエントリを持つことができる。
- **関係**: タプルの集合と定義されているため、関係内に同じ属性値のタプルを持つことができない。
※リレーショナルデータベースでは、開発者が実用上の理由からテーブル内の行を重複させることができる。

- **関係スキーマ**: 関係の設計と構造を定義
- **関係インスタンス**: 任意の時点での関係の全てのタプルのこと

![relational-schema](https://github.com/user-attachments/assets/f8263859-f0ca-4276-922c-944d8125ac14)


## 参照関係
- **キー(key)**
関係ないのタプルを一位に識別するために使用される、属性または属性の集合のことを指す。
キーを使うことで、関係内のデータにアクセスしたり、他の関係のデータを参照することができる。
キーはタプルを識別するための識別子であり、ルックアップテーブルで使用されるキーと同様に扱うことができる。

O(log n)やO(1)の速度でデータを見つけることができる。  
数学的な定義に戻ると、関係とはタプルの集合であり、全く同じ属性値を持つタプルは存在しない。タプルの全ての属性のスーパーキーとして使い、タプルを識別することができることを意味する。  
- **スーパーキー**: 関係内でタプルを一位に識別することができる任意のキー(タプルの全ての属性は、タプルを識別することができるので、定義上はスーパーキーになる。)

![super-key](https://github.com/user-attachments/assets/b123da61-70ad-47e8-8cea-d3200c9e5167)

- **候補キー**: 属性が一つでも欠けると一意に識別できなくなる属性の集合。1つの関係は複数の候補キーを持つことができる。
  例: `user` -> `username`と`email`によってタプルを識別することができるため、`username`と`email`は候補キーとなる。

![candidate-key](https://github.com/user-attachments/assets/ecc5ba13-47d8-483d-821f-a61c45cc6c1c)

- **主キー**: タプルの識別に最も好ましいものとして設計者や開発者にとって選択される候補キーで、関係に存在する候補キーが1つしかない。
  主キーがあればそのタプルの全ての情報を得ることができる。一般的には任意の属性として`id`を割り当てる。(idが最も主キーとして使用される。)

![primary-key](https://github.com/user-attachments/assets/154586e4-ab11-4f20-843b-c457e63d75b8)

- **非キー属性**: 候補に含まれない全ての属性

※ R1 = 参照関係, R2 = 非参照関係  
![foreign-key](https://github.com/user-attachments/assets/8e6e23ee-2c5e-448d-931b-043071061e5a)

外部キーとして宣言された属性は外部キー制約を持つ必要がある。この制約とは、外部キーの値Fを持つR1のタプルAが存在するためには、Fと同じ値を主キーの値とするタプルBがR2内に存在しなければいけないということを指す。  
データベースシステムは、外部キーが正しいことを確認するために整合性チェックを行う。
-　**参照整合性制約**: 一連の属性Cの値が、Cが参照する関係内のタプルに存在するかどうかを検証するもの。

- **中間テーブルの目的**: 関係の集合を参照するタプルを作成することによって特定の情報を取得すること。

## 関係と関数






