## データベースシステム

- データベース管理システム: 機能、物理的特性、論理、プロトコルを一つのソフトウェアツールに抽象化し、データの保存や読み書きを可能にしたシステム。

![database-system](https://github.com/user-attachments/assets/e840682c-2d65-4f4f-acac-a1cf4736d21b)

## データベースの特性

ファイル処理システムがあることであらゆる種類のデータをローカルストレージに保存し、後から読み出すことができる。
また、データ構造をファイルに格納できるように文字列やビット等の形式に変換するシリアル化や、ファイルを読み込んでメモリ内のオブジェクトに戻す逆シリアル化を行うこともある。

![serialize](https://github.com/user-attachments/assets/25fd2ff3-467d-42a3-b39c-b2e33edf4073)

　- トランザクション処理: データエントリの更新など、状態の変化を表すデータベースシステム内の作業単位のこと。(データの状態を変化させる作業を行う。)

### 利便性(ease of use)
- クエリ: データを取得したり操作したりするためにデータにアクセスするリクエストのこと。

### 永続性(durability)
- 一度コミットされたトランザクションが、システム障害が発生しても、コミットされた状態を維持すること。

### 一貫性と統合性(consistency and integrity)
システム内のデータは特定の情報を参照する異なるセクションが、全て同じデータを参照するように一貫性を保つ必要がある。
データエントリーは一貫性を保証するために、製薬と呼ばれる指定されたルールに従う必要がある。
統合性に関するルール: 参照チェック等、データベース内の一貫性を維持するために使用。

### 冗長性の低減(reduce redundancy)
データベースを慎重に設計することで、相互参照が可能になり、不必要な重複を減らし、データベースのストレージ使用料を低く抑えることができる。
インデックスアルゴリズム等がより強力になり、データへのアクセスをより早く実行することができる。

### 独立性と並行性(isolation and concurrency)
エントリーが入力されると、そのエントリは所定の位置にロックされるか、コミットされる。
データベースのエントリに対するトランザクションが行われると、それは分離され、完全にコミットされるまで独立して処理される。

### 原子性(Atomicity)
データベースのトランザクションにおいて、システムの状態を変化させる一連の操作が全体に起こるか、あるいは全く起こらないことを意味する。
実際の開発では、トランザクションの処理が途中で終わった場合は、前の状態にロールバックすることが通例。

![rollback](https://github.com/user-attachments/assets/96e8e359-b94b-4244-ae62-35fad7ba2f38)

- **ACID**: データベースシステムの基本で主要な要素。
原子性・一貫性・独立性・永続性

### セキュリティ(security)
システムは認証メカニズムを提供し、データがしっかりと管理されるようにする。
- 例: ソーシャルメディア上でのトラブル
ユーザーがサポートチケットを消費して、サポートデスクへ連絡 -> ユーザーの設定など特定のデータにアクセス可能だが、その他のプライベートな内容にはアクセス不可。
各データベースユーザーがアクセスできるものをフィルタリングすることができる。

![security](https://github.com/user-attachments/assets/c6b2b0c9-5cf2-4284-9db8-5e2dd09a3014)

## データベースの内部

- **クエリプロセッサー**: データベース言語を解釈し、低階層の命令にコンパイルする役割を担っている。
- **データベース言語**: データベースを操作するための言語。ほとんどの場合、SQL(structured query language)言語が採用されている。
  - データ定義言語(DDL data-definition language)
  - データ操作言語(DML data-manipulation language)
- **スキーマ**: 保存されているデータの集合体に紐づけられている全ての規則のことを指す。
  格納するデータ型、使用する物理的データ構造、データエントリの整合性と制約、承認ルールの宣言などが含まれる。
  ※誰がデータベースにデータを保存したり読み出したりできるか、どのようにデータを保存するのかを決定する。

![schema](https://github.com/user-attachments/assets/ffe39ea0-dbc8-4ec9-a56c-568f6b01062e)

- **インスタンス**: ある特定の時点でのシステム内に存在する実際のデータ
OOPの観点からは、スキーマは「クラスの設計図」、データベースのインスタンスは「ある時点で特定の状態にあるオブジェクト(クラスのインスタンス)」

![ddl-interpreter](https://github.com/user-attachments/assets/55d107b0-4dc8-4044-9c02-2fb493c49448)

- **ストレージマネージャ**:　　オペレーティングシステムの低階層I/O(Input/Ooutput API)と通信することで、データをコンピュータ内のファイルとして保存する役割を果たす。
バイナリファイルのようにオペレーティングシステム階層でコンピュータに保存されているものと、クエリプロセッサが生成する命令との間を繋ぐ役割を担う。
データに素早くアクセスできるルックアップテーブルのように、インデックスのセットを管理することができる。平衡二分探索木として実装される。

### ストレージマネージャ内
- **Authorization manager**: ユーザーがデータにアクセスする権限を持っているかどうかをデータベースのデータ辞書を参照してチェックする。
- **Integrity manager**: 状態の変更がスキーマで指定された制約と参照の生合成に従うかどうかをチェックする。
- **File manager**: ディスクストレージ内のデータ構造を決定し、ディスクストレージ内のデータの割り当てを行う。
- **Buffer manager**: メインメモリーに何をキャッシュするかを決定し、ディスクからメインメモリーへのデータの取り込みを行う。
- **Transaction manager**: データベースのトランザクション内で必要な手続きを行う。
同時実行時の一貫性の維持、ロールバックの仕組み、原子性のルールの適用など。
リレーショナルデータベースでは、ACID(原子性、一貫性、独立性、永続性)ルールが適用される。

![authorization-manager](https://github.com/user-attachments/assets/b17e5c5c-4d84-48bc-84f8-14131e370bcd)

### データベースシステム内の3つの異なる階層

![database-level](https://github.com/user-attachments/assets/823515e6-6fa5-44e7-81a7-299ca7675040)

- **物理層(physical level)**: データが物理的にどのように保存されるかを決定する。
  - データ型は何バイトか?
  - ファイル内の記号を解析する際、区切り文字は必要か??
  - 使用すべきデータ構造は何か??
  - 何をどのような方法でインデックス化するか??
- **論理層(logical level)**: スキーマ設計のように、データベースが高階層でどのように構成されているかを表す。
  - テーブル(データ集)にはどのようなデータ型を束ねるべきか??
  - 制約や整合性のルールは何か??
  - 他のテーブルのキーなど、参照すべきものはあるか(外部キーなど)??
  - データベース全体のデータ関係はどうなっているか??
- **外部層(View level)**: データベースの一部のみを表す。データベース管理者が設定するものでセキュリティ上の目的や複雑度を軽減するためのもの。

## データベースアーキテクチャ
