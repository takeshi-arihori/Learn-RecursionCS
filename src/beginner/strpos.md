
# PHPで`strpos`を使う際の注意点と解決策

PHPで文字列内の特定の文字や部分文字列の位置を取得するために、`strpos`関数を使用することがよくあります。しかし、`strpos`を使用する際には注意が必要です。特に、検索対象の文字が文字列の最初にある場合、予期しない動作をすることがあります。この記事では、その問題と解決策について説明します。

## 問題の例

以下のコードは、メールアドレス内の"@"の位置を取得しようとしています。

```php
function getAtLocation(string $email): int {
    echo strpos($email, "@") + 1 . PHP_EOL;
    return strpos($email, "@") ? strpos($email, "@") + 1 : -1;
}
```

このコードには問題があります。`strpos`関数は、"@"が文字列の最初の位置にある場合に0を返します。しかし、0はPHPで`false`と評価されるため、`return`文の条件式で誤った結果を返してしまいます。

## 解決策

この問題を解決するためには、`strpos`の結果を厳密に比較する必要があります。以下のように修正できます：

```php
function getAtLocation(string $email): int {
    $position = strpos($email, "@");
    echo $position + 1 . PHP_EOL;
    return $position !== false ? $position + 1 : -1;
}
```

この修正では、`strpos`の結果が`false`でないことを確認するために`!==`演算子を使用しています。これにより、"@"が文字列の最初の位置にある場合でも正しく位置を返すことができます。

## まとめ

`strpos`を使用する際には、返り値が0になる可能性を考慮し、`!== false`を使って厳密に比較することが重要です。このようにすることで、文字列の最初に検索対象の文字がある場合でも正しく動作するコードを書くことができます。
